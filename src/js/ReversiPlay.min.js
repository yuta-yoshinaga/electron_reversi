var LC_MSG_DRAW=0,LC_MSG_ERASE=1,LC_MSG_DRAW_INFO=2,LC_MSG_ERASE_INFO=3,LC_MSG_DRAW_ALL=4,LC_MSG_ERASE_ALL=5,LC_MSG_DRAW_INFO_ALL=6,LC_MSG_ERASE_INFO_ALL=7,LC_MSG_DRAW_END=8,LC_MSG_CUR_COL=9,LC_MSG_CUR_COL_ERASE=10,LC_MSG_CUR_STS=11,LC_MSG_CUR_STS_ERASE=12,LC_MSG_MSG_DLG=13,LC_MSG_DRAW_ALL_RESET=14,ReversiPlay=function(){function t(){this.mCurColor=0,this.mPassEnaB=0,this.mPassEnaW=0,this.mGameEndSts=0,this.mPlayLock=0,this.viewMsgDlgFunc=null,this.drawSingleFunc=null,this.curColMsgFunc=null,this.curStsMsgFunc=null,this.mReversi=new Reversi(DEF_MASU_CNT_MAX_VAL,DEF_MASU_CNT_MAX_VAL),this.mSetting=new ReversiSetting,this.mCpu=new Array,this.mEdge=new Array;for(var t=0;t<DEF_MASU_CNT_MAX_VAL*DEF_MASU_CNT_MAX_VAL;t++)this.mCpu[t]=new ReversiPoint,this.mEdge[t]=new ReversiPoint;this.reset()}return t.prototype.reversiPlay=function(t,s){var e=0,i=0,n=this.mCurColor,S=0;if(0==this.mReversi.getColorEna(this.mCurColor)?0==this.mReversi.setMasuSts(this.mCurColor,t,s)?(this.mSetting.mType==DEF_TYPE_HARD&&this.mReversi.AnalysisReversi(this.mPassEnaB,this.mPassEnaW),this.mSetting.mAssist==DEF_ASSIST_ON&&this.execMessage(LC_MSG_ERASE_INFO_ALL,null),this.sendDrawMsg(t,s),this.drawUpdate(DEF_ASSIST_OFF),0==this.mReversi.getGameEndSts()?(n=n==REVERSI_STS_BLACK?REVERSI_STS_WHITE:REVERSI_STS_BLACK,0==this.mReversi.getColorEna(n)?this.mSetting.mMode==DEF_MODE_ONE?i=1:(this.mCurColor=n,this.drawUpdate(this.mSetting.mAssist)):(this.reversiPlayPass(n),S=1)):this.reversiPlayEnd(),e=1):this.viewMsgDlg("エラー","そのマスには置けません。"):0==this.mReversi.getGameEndSts()?(n=n==REVERSI_STS_BLACK?REVERSI_STS_WHITE:REVERSI_STS_BLACK,0==this.mReversi.getColorEna(n)?this.mSetting.mMode==DEF_MODE_ONE?(e=1,i=1):this.mCurColor=n:(this.reversiPlayPass(n),S=1)):this.reversiPlayEnd(),1==S&&this.mSetting.mMode==DEF_MODE_ONE&&this.mSetting.mAssist==DEF_ASSIST_ON&&this.execMessage(LC_MSG_DRAW_INFO_ALL,null),1==e){var r=0;1==i&&(r=this.mSetting.mPlayCpuInterVal);var _=this;setTimeout(function(t,s){_.reversiPlaySub(t,s)},r,i,n)}},t.prototype.reversiPlaySub=function(t,s){for(var e;e=this.reversiPlayCpu(s,t),t=0,1==e&&(0==this.mReversi.getGameEndSts()?0!=this.mReversi.getColorEna(this.mCurColor)&&(this.reversiPlayPass(this.mCurColor),t=1):this.reversiPlayEnd()),0!=t;);},t.prototype.reversiPlayEnd=function(){if(0==this.mGameEndSts){var t=this.gameEndAnimExec(),s=this;setTimeout(function(){var t,e,i;e=s.mReversi.getBetCnt(REVERSI_STS_BLACK),i=s.mReversi.getBetCnt(REVERSI_STS_WHITE),t="黒 = "+String(e)+" 白 = "+String(i)+(s.mSetting.mMode==DEF_MODE_ONE?i==e?"引き分けです。":i<e?s.mCurColor==REVERSI_STS_BLACK?"あなたの勝ちです。":"あなたの負けです。":s.mCurColor==REVERSI_STS_WHITE?"あなたの勝ちです。":"あなたの負けです。":i==e?"引き分けです。":i<e?"黒の勝ちです。":"白の勝ちです。"),s.viewMsgDlg("ゲーム終了",t),s.mSetting.mEndAnim==DEF_END_ANIM_ON&&(s.execMessage(LC_MSG_CUR_COL,null),s.execMessage(LC_MSG_CUR_STS,null)),s.mGameEndSts=1},t)}},t.prototype.reversiPlayPass=function(t){this.mSetting.mMode==DEF_MODE_ONE?t==this.mCurColor?this.viewMsgDlg("","あなたはパスです。"):this.viewMsgDlg("","CPUはパスです。"):t==REVERSI_STS_BLACK?this.viewMsgDlg("","黒はパスです。"):this.viewMsgDlg("","白はパスです。")},t.prototype.reversiPlayCpu=function(t,s){for(var e,i,n=0;1==s;){s=0;var S=this.mReversi.getPointCnt(t),r=this.mReversi.getPoint(t,Math.floor(Math.random()*S));if(null!=r){if(e=r.y,i=r.x,this.mSetting.mType!=DEF_TYPE_EASY){var _,m,o,a,h,g,E,C,u,M,l,R,A,v,L,D,d;_=0,m=0,o=0,a=0,h=-1,g=-1,E=-1,C=-1,u=0,M=0,l=0,R=this.mSetting.mMasuCnt*this.mSetting.mMasuCnt,A=0,v=0,L=t==REVERSI_STS_BLACK?REVERSI_STS_WHITE:REVERSI_STS_BLACK,d=0,R-((D=this.mReversi.getBetCnt(L))+this.mReversi.getBetCnt(t))<=16&&(d=1);for(F=0;F<R;F++)this.mCpu[F].x=0,this.mCpu[F].y=0,this.mEdge[F].x=0,this.mEdge[F].y=0;for(F=0;F<this.mSetting.mMasuCnt;F++)for(var c=0;c<this.mSetting.mMasuCnt;c++)0!=this.mReversi.getMasuStsEna(t,F,c)&&(0==this.mReversi.getEdgeSideOne(F,c)?(this.mEdge[l].x=c,this.mEdge[l].y=F,l++):(this.mCpu[u].x=c,this.mCpu[u].y=F,u++),this.mSetting.mType==DEF_TYPE_NOR&&(0==this.mReversi.getEdgeSideZero(F,c)&&(m=1,M=u-1),0==m&&0==this.mReversi.getEdgeSideTwo(F,c)&&(o=1,M=u-1),0==m&&0==o&&0==this.mReversi.getEdgeSideThree(F,c)&&(_=1,M=u-1)),this.mReversi.getMasuStsCnt(t,F,c)==D&&(e=F,i=c,A=1),0==A&&0!=this.mReversi.getPassEna(t,F,c)&&(e=F,i=c,v=1));if(0==A&&0==v){var y,P=-1,p=-1,f=-1,T=-1;if(0!=u){for(F=0;F<u;F++)this.mSetting.mType==DEF_TYPE_HARD&&null!=(y=this.mReversi.getPointAnz(t,this.mCpu[F].y,this.mCpu[F].x))&&(-1==P?(P=y.badPoint,p=y.goodPoint,f=y.pointCnt,T=y.ownPointCnt,g=F,E=F,C=F):(y.badPoint<P&&(P=y.badPoint,g=F),p<y.goodPoint&&(p=y.goodPoint,E=F),y.pointCnt<f?(f=y.pointCnt,T=y.ownPointCnt,C=F):y.pointCnt==f&&T<y.ownPointCnt&&(T=y.ownPointCnt,C=F))),2==this.mReversi.getMasuStsEna(t,this.mCpu[F].y,this.mCpu[F].x)&&(h=F);-1!=g&&(0!=d?-1!=E&&(g=E):-1!=C&&(g=C),h=g),-1==h&&(h=Math.floor(Math.random()*u))}else if(0!=l){for(F=0;F<l;F++)this.mSetting.mType==DEF_TYPE_HARD&&null!=(y=this.mReversi.getPointAnz(t,this.mEdge[F].y,this.mEdge[F].x))&&(-1==P?(P=y.badPoint,p=y.goodPoint,f=y.pointCnt,T=y.ownPointCnt,g=F,E=F,C=F):(y.badPoint<P&&(P=y.badPoint,g=F),p<y.goodPoint&&(p=y.goodPoint,E=F),y.pointCnt<f?(f=y.pointCnt,T=y.ownPointCnt,C=F):y.pointCnt==f&&T<y.ownPointCnt&&(T=y.ownPointCnt,C=F))),2==this.mReversi.getMasuStsEna(t,this.mEdge[F].y,this.mEdge[F].x)&&(h=F);-1!=g&&(0!=d?-1!=E&&(g=E):-1!=C&&(g=C),h=g),-1==h&&(h=Math.floor(Math.random()*l));for(var F=0;F<l;F++)0!=this.mReversi.checkEdge(t,this.mEdge[F].y,this.mEdge[F].x)&&0==_&&0==m&&0==o&&(a=1,M=F)}0==m&&0==o&&0==_&&0==a&&(M=h),0!=u?(e=this.mCpu[M].y,i=this.mCpu[M].x):0!=l&&(e=this.mEdge[M].y,i=this.mEdge[M].x)}}0==this.mReversi.setMasuSts(t,e,i)&&(this.mSetting.mType==DEF_TYPE_HARD&&this.mReversi.AnalysisReversi(this.mPassEnaB,this.mPassEnaW),this.sendDrawMsg(e,i),n=1)}}return 1==n&&(this.drawUpdate(DEF_ASSIST_OFF),this.mSetting.mAssist==DEF_ASSIST_ON&&this.execMessage(LC_MSG_DRAW_INFO_ALL,null)),n},t.prototype.drawUpdate=function(t){if(t==DEF_ASSIST_ON)for(i=0;i<this.mSetting.mMasuCnt;i++)for(n=0;n<this.mSetting.mMasuCnt;n++)this.sendDrawInfoMsg(i,n);for(var s=this.mSetting.mPlayDrawInterVal,e=this,i=0;i<this.mSetting.mMasuCnt;i++)for(var n=0;n<this.mSetting.mMasuCnt;n++)this.mReversi.getMasuSts(i,n)!=this.mReversi.getMasuStsOld(i,n)&&(setTimeout(function(t,s){e.sendDrawMsg(t,s)},s,i,n),s+=this.mSetting.mPlayDrawInterVal);this.execMessage(LC_MSG_CUR_COL,null),this.execMessage(LC_MSG_CUR_STS,null)},t.prototype.drawUpdateForcibly=function(t){this.execMessage(LC_MSG_DRAW_ALL,null),t==DEF_ASSIST_ON?this.execMessage(LC_MSG_DRAW_INFO_ALL,null):this.execMessage(LC_MSG_ERASE_INFO_ALL,null),this.execMessage(LC_MSG_CUR_COL,null),this.execMessage(LC_MSG_CUR_STS,null)},t.prototype.reset=function(){if(this.mPassEnaB=0,this.mPassEnaW=0,this.mSetting.mGameSpd==DEF_GAME_SPD_FAST?(this.mSetting.mPlayDrawInterVal=DEF_GAME_SPD_FAST_VAL,this.mSetting.mPlayCpuInterVal=DEF_GAME_SPD_FAST_VAL2):this.mSetting.mGameSpd==DEF_GAME_SPD_MID?(this.mSetting.mPlayDrawInterVal=DEF_GAME_SPD_MID_VAL,this.mSetting.mPlayCpuInterVal=DEF_GAME_SPD_MID_VAL2):(this.mSetting.mPlayDrawInterVal=DEF_GAME_SPD_SLOW_VAL,this.mSetting.mPlayCpuInterVal=DEF_GAME_SPD_SLOW_VAL2),this.mCurColor=this.mSetting.mPlayer,this.mSetting.mMode==DEF_MODE_TWO&&(this.mCurColor=REVERSI_STS_BLACK),this.mReversi.setMasuCnt(this.mSetting.mMasuCnt),this.mReversi.reset(),this.mSetting.mMode==DEF_MODE_ONE&&this.mCurColor==REVERSI_STS_WHITE){var t=this.mReversi.getPointCnt(REVERSI_STS_BLACK),s=this.mReversi.getPoint(REVERSI_STS_BLACK,Math.floor(Math.random()*t));null!=s&&(this.mReversi.setMasuSts(REVERSI_STS_BLACK,s.y,s.x),this.mSetting.mType==DEF_TYPE_HARD&&this.mReversi.AnalysisReversi(this.mPassEnaB,this.mPassEnaW))}this.mPlayLock=1,this.mGameEndSts=0,this.drawUpdateForcibly(this.mSetting.mAssist),this.execMessage(LC_MSG_DRAW_END,null)},t.prototype.gameEndAnimExec=function(){var t,s,e=0;if(this.mSetting.mEndAnim==DEF_END_ANIM_ON){t=this.mReversi.getBetCnt(REVERSI_STS_BLACK),s=this.mReversi.getBetCnt(REVERSI_STS_WHITE),this.execMessage(LC_MSG_CUR_COL_ERASE,null),this.execMessage(LC_MSG_CUR_STS_ERASE,null);var i=this;setTimeout(function(t,s){for(m=0;m<i.mSetting.mMasuCnt;m++)for(o=0;o<i.mSetting.mMasuCnt;o++)i.mReversi.setMasuStsForcibly(REVERSI_STS_NONE,m,o);i.execMessage(LC_MSG_ERASE_ALL,null);var e,n,S,r;e=0,n=0,S=0,r=0;for(var _=i.mSetting.mEndDrawInterVal,m=0;m<i.mSetting.mMasuCnt;m++)for(var o=0;o<i.mSetting.mMasuCnt&&(e<t?(e++,setTimeout(function(t,s){i.mReversi.setMasuStsForcibly(REVERSI_STS_BLACK,t,s),i.sendDrawMsg(t,s)},_,m,o)):S=1,n<s?(n++,setTimeout(function(t,s){i.mReversi.setMasuStsForcibly(REVERSI_STS_WHITE,i.mSetting.mMasuCnt-1-t,i.mSetting.mMasuCnt-1-s),i.sendDrawMsg(i.mSetting.mMasuCnt-1-t,i.mSetting.mMasuCnt-1-s)},_,m,o)):r=1,1!=S||1!=r);o++)_+=i.mSetting.mEndDrawInterVal},this.mSetting.mEndInterVal,t,s),e=this.mSetting.mEndInterVal+this.mSetting.mEndDrawInterVal*(this.mSetting.mMasuCnt*this.mSetting.mMasuCnt)}return e},t.prototype.sendDrawMsg=function(t,s){var e=new ReversiPoint;e.y=t,e.x=s,this.execMessage(LC_MSG_DRAW,e)},t.prototype.sendDrawInfoMsg=function(t,s){var e=new ReversiPoint;e.y=t,e.x=s,this.execMessage(LC_MSG_DRAW_INFO,e)},t.prototype.setViewMsgDlgFunc=function(t){this.viewMsgDlgFunc=t},t.prototype.viewMsgDlg=function(t,s){null!=this.viewMsgDlgFunc&&this.viewMsgDlgFunc(t,s)},t.prototype.setDrawSingleFunc=function(t){this.drawSingleFunc=t},t.prototype.drawSingle=function(t,s,e,i,n){null!=this.drawSingleFunc&&("0"==n&&(n=""),this.drawSingleFunc(t,s,e,i,n))},t.prototype.setCurColMsgFunc=function(t){this.curColMsgFunc=t},t.prototype.curColMsg=function(t){null!=this.curColMsgFunc&&this.curColMsgFunc(t)},t.prototype.setCurStsMsgFunc=function(t){this.curStsMsgFunc=t},t.prototype.curStsMsg=function(t){null!=this.curStsMsgFunc&&this.curStsMsgFunc(t)},t.prototype.execMessage=function(t,s){var e,i,n;if(t==LC_MSG_DRAW){S=s;e=this.mReversi.getMasuSts(S.y,S.x),i=this.mReversi.getMasuStsEna(this.mCurColor,S.y,S.x),n=this.mReversi.getMasuStsCnt(this.mCurColor,S.y,S.x),this.drawSingle(S.y,S.x,e,i,String(n))}else if(t==LC_MSG_ERASE){S=s;this.drawSingle(S.y,S.x,0,0,String(0))}else if(t==LC_MSG_DRAW_INFO){S=s;e=this.mReversi.getMasuSts(S.y,S.x),i=this.mReversi.getMasuStsEna(this.mCurColor,S.y,S.x),n=this.mReversi.getMasuStsCnt(this.mCurColor,S.y,S.x),this.drawSingle(S.y,S.x,e,i,String(n))}else if(t==LC_MSG_ERASE_INFO){var S=s;e=this.mReversi.getMasuSts(S.y,S.x),this.drawSingle(S.y,S.x,e,0,String(0))}else if(t==LC_MSG_DRAW_ALL)for(r=0;r<this.mSetting.mMasuCnt;r++)for(_=0;_<this.mSetting.mMasuCnt;_++)e=this.mReversi.getMasuSts(r,_),i=this.mReversi.getMasuStsEna(this.mCurColor,r,_),n=this.mReversi.getMasuStsCnt(this.mCurColor,r,_),this.drawSingle(r,_,e,i,String(n));else if(t==LC_MSG_ERASE_ALL)for(r=0;r<this.mSetting.mMasuCnt;r++)for(_=0;_<this.mSetting.mMasuCnt;_++)this.drawSingle(r,_,0,0,String(0));else if(t==LC_MSG_DRAW_INFO_ALL)for(r=0;r<this.mSetting.mMasuCnt;r++)for(_=0;_<this.mSetting.mMasuCnt;_++)e=this.mReversi.getMasuSts(r,_),i=this.mReversi.getMasuStsEna(this.mCurColor,r,_),n=this.mReversi.getMasuStsCnt(this.mCurColor,r,_),this.drawSingle(r,_,e,i,String(n));else if(t==LC_MSG_ERASE_INFO_ALL)for(var r=0;r<this.mSetting.mMasuCnt;r++)for(var _=0;_<this.mSetting.mMasuCnt;_++)e=this.mReversi.getMasuSts(r,_),this.drawSingle(r,_,e,0,String(0));else if(t==LC_MSG_DRAW_END)this.mPlayLock=0;else if(t==LC_MSG_CUR_COL){m="";m=this.mSetting.mMode==DEF_MODE_ONE?this.mCurColor==REVERSI_STS_BLACK?"あなたは黒です ":"あなたは白です ":this.mCurColor==REVERSI_STS_BLACK?"黒の番です ":"白の番です ",this.curColMsg(m)}else if(t==LC_MSG_CUR_COL_ERASE)this.curColMsg("");else if(t==LC_MSG_CUR_STS){var m="黒 = "+this.mReversi.getBetCnt(REVERSI_STS_BLACK)+" 白 = "+this.mReversi.getBetCnt(REVERSI_STS_WHITE);this.curStsMsg(m)}else t==LC_MSG_CUR_STS_ERASE&&this.curStsMsg("")},t.prototype.setSetting=function(t){this.mSetting=t},t.prototype.getetSetting=function(){return this.mSetting},t}();