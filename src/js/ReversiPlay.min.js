var LC_MSG_DRAW=0,LC_MSG_ERASE=1,LC_MSG_DRAW_INFO=2,LC_MSG_ERASE_INFO=3,LC_MSG_DRAW_ALL=4,LC_MSG_ERASE_ALL=5,LC_MSG_DRAW_INFO_ALL=6,LC_MSG_ERASE_INFO_ALL=7,LC_MSG_DRAW_END=8,LC_MSG_CUR_COL=9,LC_MSG_CUR_COL_ERASE=10,LC_MSG_CUR_STS=11,LC_MSG_CUR_STS_ERASE=12,LC_MSG_MSG_DLG=13,LC_MSG_DRAW_ALL_RESET=14,ReversiPlay=function(){function t(){this.mCurColor=0,this.mPassEnaB=0,this.mPassEnaW=0,this.mGameEndSts=0,this.mPlayLock=0,this.viewMsgDlgFunc=null,this.drawSingleFunc=null,this.curColMsgFunc=null,this.curStsMsgFunc=null,this.mReversi=new Reversi(DEF_MASU_CNT_MAX_VAL,DEF_MASU_CNT_MAX_VAL),this.mSetting=new ReversiSetting,this.mCpu=new Array,this.mEdge=new Array;for(var t=0;t<DEF_MASU_CNT_MAX_VAL*DEF_MASU_CNT_MAX_VAL;t++)this.mCpu[t]=new ReversiPoint,this.mEdge[t]=new ReversiPoint;this.reset()}return t.prototype.reversiPlay=function(t,s){var e=0,i=0,n=this.mCurColor,r=0;if(1!=this.mPlayLock)if(this.mPlayLock=1,0==this.mReversi.getColorEna(this.mCurColor)?0==this.mReversi.setMasuSts(this.mCurColor,t,s)?(this.mSetting.mType==DEF_TYPE_HARD&&this.mReversi.AnalysisReversi(this.mPassEnaB,this.mPassEnaW),this.mSetting.mAssist==DEF_ASSIST_ON&&this.execMessage(LC_MSG_ERASE_INFO_ALL,null),this.sendDrawMsg(t,s),this.drawUpdate(DEF_ASSIST_OFF),0==this.mReversi.getGameEndSts()?(n=n==REVERSI_STS_BLACK?REVERSI_STS_WHITE:REVERSI_STS_BLACK,0==this.mReversi.getColorEna(n)?this.mSetting.mMode==DEF_MODE_ONE?i=1:(this.mCurColor=n,this.drawUpdate(this.mSetting.mAssist)):(this.reversiPlayPass(n),r=1)):this.reversiPlayEnd(),e=1):this.viewMsgDlg("エラー","そのマスには置けません。"):0==this.mReversi.getGameEndSts()?(n=n==REVERSI_STS_BLACK?REVERSI_STS_WHITE:REVERSI_STS_BLACK,0==this.mReversi.getColorEna(n)?this.mSetting.mMode==DEF_MODE_ONE?(e=1,i=1):this.mCurColor=n:(this.reversiPlayPass(n),r=1)):this.reversiPlayEnd(),1==r&&this.mSetting.mMode==DEF_MODE_ONE&&this.mSetting.mAssist==DEF_ASSIST_ON&&this.execMessage(LC_MSG_DRAW_INFO_ALL,null),1==e){var S=0;1==i&&(S=this.mSetting.mPlayCpuInterVal);var _=this;setTimeout(function(t,s){_.reversiPlaySub(t,s),_.mPlayLock=0},S,i,n)}else this.mPlayLock=0},t.prototype.reversiPlaySub=function(t,s){for(var e;e=this.reversiPlayCpu(s,t),t=0,1==e&&(0==this.mReversi.getGameEndSts()?0!=this.mReversi.getColorEna(this.mCurColor)&&(this.reversiPlayPass(this.mCurColor),t=1):this.reversiPlayEnd()),0!=t;);},t.prototype.reversiPlayEnd=function(){if(0==this.mGameEndSts){this.mGameEndSts=1;var t=this.gameEndAnimExec(),s=this;this.mPlayLock=1,setTimeout(function(){var t,e,i,n,r;n=s.mReversi.getBetCnt(REVERSI_STS_BLACK),r=s.mReversi.getBetCnt(REVERSI_STS_WHITE),t="プレイヤー1 = "+String(n)+" プレイヤー2 = "+String(r),e=s.mSetting.mMode==DEF_MODE_ONE?r==n?"引き分けです。":n>r?s.mCurColor==REVERSI_STS_BLACK?"あなたの勝ちです。":"あなたの負けです。":s.mCurColor==REVERSI_STS_WHITE?"あなたの勝ちです。":"あなたの負けです。":r==n?"引き分けです。":n>r?"プレイヤー1の勝ちです。":"プレイヤー2の勝ちです。",i=t+e,s.viewMsgDlg("ゲーム終了",i),s.mSetting.mEndAnim==DEF_END_ANIM_ON&&(s.execMessage(LC_MSG_CUR_COL,null),s.execMessage(LC_MSG_CUR_STS,null))},t)}},t.prototype.reversiPlayPass=function(t){this.mSetting.mMode==DEF_MODE_ONE?t==this.mCurColor?this.viewMsgDlg("","あなたはパスです。"):this.viewMsgDlg("","CPUはパスです。"):t==REVERSI_STS_BLACK?this.viewMsgDlg("","プレイヤー1はパスです。"):this.viewMsgDlg("","プレイヤー2はパスです。")},t.prototype.reversiPlayCpu=function(t,s){for(var e,i,n=0;1==s;){s=0;var r=this.mReversi.getPointCnt(t),S=this.mReversi.getPoint(t,Math.floor(Math.random()*r));if(null!=S){if(e=S.y,i=S.x,this.mSetting.mType!=DEF_TYPE_EASY){var _,m,a,o,h,E,g,C,u,M,l,R,v,A,L,D,d,c;_=0,m=0,a=0,o=0,h=-1,E=-1,g=-1,C=-1,u=0,M=0,l=0,R=this.mSetting.mMasuCnt*this.mSetting.mMasuCnt,v=0,A=0,L=t==REVERSI_STS_BLACK?REVERSI_STS_WHITE:REVERSI_STS_BLACK,D=this.mReversi.getBetCnt(L),d=this.mReversi.getBetCnt(t),c=0,16>=R-(D+d)&&(c=1);for(var y=0;R>y;y++)this.mCpu[y].x=0,this.mCpu[y].y=0,this.mEdge[y].x=0,this.mEdge[y].y=0;for(var y=0;y<this.mSetting.mMasuCnt;y++)for(var P=0;P<this.mSetting.mMasuCnt;P++)0!=this.mReversi.getMasuStsEna(t,y,P)&&(0==this.mReversi.getEdgeSideOne(y,P)?(this.mEdge[l].x=P,this.mEdge[l].y=y,l++):(this.mCpu[u].x=P,this.mCpu[u].y=y,u++),this.mSetting.mType==DEF_TYPE_NOR&&(0==this.mReversi.getEdgeSideZero(y,P)&&(m=1,M=u-1),0==m&&0==this.mReversi.getEdgeSideTwo(y,P)&&(a=1,M=u-1),0==m&&0==a&&0==this.mReversi.getEdgeSideThree(y,P)&&(_=1,M=u-1)),this.mReversi.getMasuStsCnt(t,y,P)==D&&(e=y,i=P,v=1),0==v&&0!=this.mReversi.getPassEna(t,y,P)&&(e=y,i=P,A=1));if(0==v&&0==A){var p,f=-1,T=-1,F=-1,I=-1;if(0!=u){for(var y=0;u>y;y++)this.mSetting.mType==DEF_TYPE_HARD&&(p=this.mReversi.getPointAnz(t,this.mCpu[y].y,this.mCpu[y].x),null!=p&&(-1==f?(f=p.badPoint,T=p.goodPoint,F=p.pointCnt,I=p.ownPointCnt,E=y,g=y,C=y):(p.badPoint<f&&(f=p.badPoint,E=y),T<p.goodPoint&&(T=p.goodPoint,g=y),p.pointCnt<F?(F=p.pointCnt,I=p.ownPointCnt,C=y):p.pointCnt==F&&I<p.ownPointCnt&&(I=p.ownPointCnt,C=y)))),2==this.mReversi.getMasuStsEna(t,this.mCpu[y].y,this.mCpu[y].x)&&(h=y);-1!=E&&(0!=c?-1!=g&&(E=g):-1!=C&&(E=C),h=E),-1==h&&(h=Math.floor(Math.random()*u))}else if(0!=l){for(var y=0;l>y;y++)this.mSetting.mType==DEF_TYPE_HARD&&(p=this.mReversi.getPointAnz(t,this.mEdge[y].y,this.mEdge[y].x),null!=p&&(-1==f?(f=p.badPoint,T=p.goodPoint,F=p.pointCnt,I=p.ownPointCnt,E=y,g=y,C=y):(p.badPoint<f&&(f=p.badPoint,E=y),T<p.goodPoint&&(T=p.goodPoint,g=y),p.pointCnt<F?(F=p.pointCnt,I=p.ownPointCnt,C=y):p.pointCnt==F&&I<p.ownPointCnt&&(I=p.ownPointCnt,C=y)))),2==this.mReversi.getMasuStsEna(t,this.mEdge[y].y,this.mEdge[y].x)&&(h=y);-1!=E&&(0!=c?-1!=g&&(E=g):-1!=C&&(E=C),h=E),-1==h&&(h=Math.floor(Math.random()*l));for(var y=0;l>y;y++)0!=this.mReversi.checkEdge(t,this.mEdge[y].y,this.mEdge[y].x)&&0==_&&0==m&&0==a&&(o=1,M=y)}0==m&&0==a&&0==_&&0==o&&(M=h),0!=u?(e=this.mCpu[M].y,i=this.mCpu[M].x):0!=l&&(e=this.mEdge[M].y,i=this.mEdge[M].x)}}0==this.mReversi.setMasuSts(t,e,i)&&(this.mSetting.mType==DEF_TYPE_HARD&&this.mReversi.AnalysisReversi(this.mPassEnaB,this.mPassEnaW),this.sendDrawMsg(e,i),n=1)}}return 1==n&&(this.drawUpdate(DEF_ASSIST_OFF),this.mSetting.mAssist==DEF_ASSIST_ON&&this.execMessage(LC_MSG_DRAW_INFO_ALL,null)),n},t.prototype.drawUpdate=function(t){if(t==DEF_ASSIST_ON)for(var s=0;s<this.mSetting.mMasuCnt;s++)for(var e=0;e<this.mSetting.mMasuCnt;e++)this.sendDrawInfoMsg(s,e);for(var i=this.mSetting.mPlayDrawInterVal,n=this,s=0;s<this.mSetting.mMasuCnt;s++)for(var e=0;e<this.mSetting.mMasuCnt;e++)this.mReversi.getMasuSts(s,e)!=this.mReversi.getMasuStsOld(s,e)&&(setTimeout(function(t,s){n.sendDrawMsg(t,s)},i,s,e),i+=this.mSetting.mPlayDrawInterVal);this.execMessage(LC_MSG_CUR_COL,null),this.execMessage(LC_MSG_CUR_STS,null)},t.prototype.drawUpdateForcibly=function(t){this.execMessage(LC_MSG_DRAW_ALL,null),t==DEF_ASSIST_ON?this.execMessage(LC_MSG_DRAW_INFO_ALL,null):this.execMessage(LC_MSG_ERASE_INFO_ALL,null),this.execMessage(LC_MSG_CUR_COL,null),this.execMessage(LC_MSG_CUR_STS,null)},t.prototype.reset=function(){if(this.mPassEnaB=0,this.mPassEnaW=0,this.mSetting.mGameSpd==DEF_GAME_SPD_FAST?(this.mSetting.mPlayDrawInterVal=DEF_GAME_SPD_FAST_VAL,this.mSetting.mPlayCpuInterVal=DEF_GAME_SPD_FAST_VAL2):this.mSetting.mGameSpd==DEF_GAME_SPD_MID?(this.mSetting.mPlayDrawInterVal=DEF_GAME_SPD_MID_VAL,this.mSetting.mPlayCpuInterVal=DEF_GAME_SPD_MID_VAL2):(this.mSetting.mPlayDrawInterVal=DEF_GAME_SPD_SLOW_VAL,this.mSetting.mPlayCpuInterVal=DEF_GAME_SPD_SLOW_VAL2),this.mCurColor=this.mSetting.mPlayer,this.mSetting.mMode==DEF_MODE_TWO&&(this.mCurColor=REVERSI_STS_BLACK),this.mReversi.setMasuCnt(this.mSetting.mMasuCnt),this.mReversi.reset(),this.mSetting.mMode==DEF_MODE_ONE&&this.mCurColor==REVERSI_STS_WHITE){var t=this.mReversi.getPointCnt(REVERSI_STS_BLACK),s=this.mReversi.getPoint(REVERSI_STS_BLACK,Math.floor(Math.random()*t));null!=s&&(this.mReversi.setMasuSts(REVERSI_STS_BLACK,s.y,s.x),this.mSetting.mType==DEF_TYPE_HARD&&this.mReversi.AnalysisReversi(this.mPassEnaB,this.mPassEnaW))}this.mPlayLock=1,this.mGameEndSts=0,this.drawUpdateForcibly(this.mSetting.mAssist),this.execMessage(LC_MSG_DRAW_END,null)},t.prototype.gameEndAnimExec=function(){var t,s,e=2,i=0;if(this.mSetting.mEndAnim==DEF_END_ANIM_ON){t=this.mReversi.getBetCnt(REVERSI_STS_BLACK),s=this.mReversi.getBetCnt(REVERSI_STS_WHITE),this.execMessage(LC_MSG_CUR_COL_ERASE,null),this.execMessage(LC_MSG_CUR_STS_ERASE,null);var n=this;setTimeout(function(t,s){for(var e=0;e<n.mSetting.mMasuCnt;e++)for(var i=0;i<n.mSetting.mMasuCnt;i++)n.mReversi.setMasuStsForcibly(REVERSI_STS_NONE,e,i);n.execMessage(LC_MSG_ERASE_ALL,null);var r,S,_,m;r=0,S=0,_=0,m=0;for(var a=n.mSetting.mEndDrawInterVal,e=0;e<n.mSetting.mMasuCnt;e++)for(var i=0;i<n.mSetting.mMasuCnt&&(t>r?(r++,setTimeout(function(t,s){n.mReversi.setMasuStsForcibly(REVERSI_STS_BLACK,t,s),n.sendDrawMsg(t,s)},a,e,i)):_=1,s>S?(S++,setTimeout(function(t,s){n.mReversi.setMasuStsForcibly(REVERSI_STS_WHITE,n.mSetting.mMasuCnt-1-t,n.mSetting.mMasuCnt-1-s),n.sendDrawMsg(n.mSetting.mMasuCnt-1-t,n.mSetting.mMasuCnt-1-s)},a,e,i)):m=1,1!=_||1!=m);i++)a+=n.mSetting.mEndDrawInterVal},this.mSetting.mEndInterVal,t,s),i=this.mSetting.mEndInterVal+this.mSetting.mEndDrawInterVal*(Math.max(t,s)+e)}return i},t.prototype.sendDrawMsg=function(t,s){var e=new ReversiPoint;e.y=t,e.x=s,this.execMessage(LC_MSG_DRAW,e)},t.prototype.sendDrawInfoMsg=function(t,s){var e=new ReversiPoint;e.y=t,e.x=s,this.execMessage(LC_MSG_DRAW_INFO,e)},t.prototype.setViewMsgDlgFunc=function(t){this.viewMsgDlgFunc=t},t.prototype.viewMsgDlg=function(t,s){null!=this.viewMsgDlgFunc&&this.viewMsgDlgFunc(t,s)},t.prototype.setDrawSingleFunc=function(t){this.drawSingleFunc=t},t.prototype.drawSingle=function(t,s,e,i,n){null!=this.drawSingleFunc&&("0"==n&&(n=""),this.drawSingleFunc(t,s,e,i,n))},t.prototype.setCurColMsgFunc=function(t){this.curColMsgFunc=t},t.prototype.curColMsg=function(t){null!=this.curColMsgFunc&&this.curColMsgFunc(t)},t.prototype.setCurStsMsgFunc=function(t){this.curStsMsgFunc=t},t.prototype.curStsMsg=function(t){null!=this.curStsMsgFunc&&this.curStsMsgFunc(t)},t.prototype.execMessage=function(t,s){var e,i,n;if(t==LC_MSG_DRAW){var r=s;e=this.mReversi.getMasuSts(r.y,r.x),i=this.mReversi.getMasuStsEna(this.mCurColor,r.y,r.x),n=this.mReversi.getMasuStsCnt(this.mCurColor,r.y,r.x),this.drawSingle(r.y,r.x,e,i,String(n))}else if(t==LC_MSG_ERASE){var r=s;this.drawSingle(r.y,r.x,0,0,String(0))}else if(t==LC_MSG_DRAW_INFO){var r=s;e=this.mReversi.getMasuSts(r.y,r.x),i=this.mReversi.getMasuStsEna(this.mCurColor,r.y,r.x),n=this.mReversi.getMasuStsCnt(this.mCurColor,r.y,r.x),this.drawSingle(r.y,r.x,e,i,String(n))}else if(t==LC_MSG_ERASE_INFO){var r=s;e=this.mReversi.getMasuSts(r.y,r.x),this.drawSingle(r.y,r.x,e,0,String(0))}else if(t==LC_MSG_DRAW_ALL)for(var S=0;S<this.mSetting.mMasuCnt;S++)for(var _=0;_<this.mSetting.mMasuCnt;_++)e=this.mReversi.getMasuSts(S,_),i=this.mReversi.getMasuStsEna(this.mCurColor,S,_),n=this.mReversi.getMasuStsCnt(this.mCurColor,S,_),this.drawSingle(S,_,e,i,String(n));else if(t==LC_MSG_ERASE_ALL)for(var S=0;S<this.mSetting.mMasuCnt;S++)for(var _=0;_<this.mSetting.mMasuCnt;_++)this.drawSingle(S,_,0,0,String(0));else if(t==LC_MSG_DRAW_INFO_ALL)for(var S=0;S<this.mSetting.mMasuCnt;S++)for(var _=0;_<this.mSetting.mMasuCnt;_++)e=this.mReversi.getMasuSts(S,_),i=this.mReversi.getMasuStsEna(this.mCurColor,S,_),n=this.mReversi.getMasuStsCnt(this.mCurColor,S,_),this.drawSingle(S,_,e,i,String(n));else if(t==LC_MSG_ERASE_INFO_ALL)for(var S=0;S<this.mSetting.mMasuCnt;S++)for(var _=0;_<this.mSetting.mMasuCnt;_++)e=this.mReversi.getMasuSts(S,_),this.drawSingle(S,_,e,0,String(0));else if(t==LC_MSG_DRAW_END)this.mPlayLock=0;else if(t==LC_MSG_CUR_COL){var m="";m=this.mSetting.mMode==DEF_MODE_ONE?this.mCurColor==REVERSI_STS_BLACK?"あなたはプレイヤー1です ":"あなたはプレイヤー2です ":this.mCurColor==REVERSI_STS_BLACK?"プレイヤー1の番です ":"プレイヤー2の番です ",this.curColMsg(m)}else if(t==LC_MSG_CUR_COL_ERASE)this.curColMsg("");else if(t==LC_MSG_CUR_STS){var m="プレイヤー1 = "+this.mReversi.getBetCnt(REVERSI_STS_BLACK)+" プレイヤー2 = "+this.mReversi.getBetCnt(REVERSI_STS_WHITE);this.curStsMsg(m)}else t==LC_MSG_CUR_STS_ERASE&&this.curStsMsg("")},t.prototype.setSetting=function(t){this.mSetting=t},t.prototype.getetSetting=function(){return this.mSetting},t}();